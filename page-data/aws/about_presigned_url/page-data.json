{"componentChunkName":"component---src-template-post-tsx","path":"/aws/about_presigned_url/","result":{"data":{"site":{"siteMetadata":{"comment":{"utterances":"akasai/akasai.github.io"}}},"post":{"id":"1e55851e-1a3f-588c-b0da-091d9059fd95","excerpt":"S3의 접근권한이 일 경우 버킷과 파일주소만 안다면 업로드된 파일을 자유롭게 접근가능하다. 이를 통해서 S…","timeToRead":3,"html":"<p><strong>S3</strong>의 접근권한이 <code class=\"language-text\">Public</code>일 경우 버킷과 파일주소만 안다면 업로드된 파일을 자유롭게 접근가능하다.</p>\n<p>이를 통해서 S3에 이미지 리소스를 저장한다거나 업로드되는 파일을 저장하는 방법으로 사용하고 있다.</p>\n<p>이런 편의성은 큰 장점이지만 보안관점에서 본다면 <strong>큰 위험요소</strong>가 될 수 있다.</p>\n<br>\n<p><strong>AWS S3</strong>에서는 이런 위험요소를 보안하기 위해서 <strong>미리 서명된 URL</strong>(<code class=\"language-text\">Presigned-URL</code>)이라는 기능을 제공한다.</p>\n<p>이 기능은 제한된 시간동안 접근권한을 부여하는 기능이다.</p>\n<p>이를 이용하면 특정 대상에게 제한된 시간동안 <strong>S3</strong>의 접근권한을 부여하여 조금이나마 위험부담을 줄일 수 있다.</p>\n<hr>\n<h2 id=\"presigned-url\" style=\"position:relative;\"><a href=\"#presigned-url\" aria-label=\"presigned url permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Presigned-URL</h2>\n<p><strong>AWS</strong>의 기본적인 세팅(<code class=\"language-text\">IAM</code>, <code class=\"language-text\">S3</code>)은 완료되어 있어야 한다. 그리고 <code class=\"language-text\">aws-sdk</code>패키지를 이용해서 URL을 만든다.</p>\n<h3 id=\"1-aws-sdk-세팅하기\" style=\"position:relative;\"><a href=\"#1-aws-sdk-%EC%84%B8%ED%8C%85%ED%95%98%EA%B8%B0\" aria-label=\"1 aws sdk 세팅하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. AWS-SDK 세팅하기</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> i aws-sdk</code></pre></div>\n<p>설치가 끝나면 <code class=\"language-text\">aws-sdk</code>초기화를 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">AWS</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'aws-sdk'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> accessKeyId <span class=\"token operator\">=</span> <span class=\"token string\">'######'</span>\n<span class=\"token keyword\">const</span> secretAccessKey <span class=\"token operator\">=</span> <span class=\"token string\">'######'</span>\n\n<span class=\"token constant\">AWS</span><span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>accessKeyId<span class=\"token punctuation\">,</span> secretAccessKey<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>기본적인 <code class=\"language-text\">aws-sdk</code>세팅이 끝나면 S3객체를 만든다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> s3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AWS<span class=\"token punctuation\">.</span>S3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>signatureVersion<span class=\"token operator\">:</span> <span class=\"token string\">'v4'</span><span class=\"token punctuation\">,</span> region<span class=\"token operator\">:</span> <span class=\"token string\">'Region'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">signatureVersion</code>: api의 버전. 버전별로 만들어지는 URL의 형태와 암호화로직이 다르다. (‘v2’, ‘v3’, ‘v4’)</p>\n<p><code class=\"language-text\">region</code>: 엑세스 요청을 보낼 리젼. 이 리젼에 따라서 <strong>endPoint</strong>의 URL도 변경된다.</p>\n<blockquote>\n<p><strong>Note</strong>: The default signer allows altering the request by adding corresponding headers to set some parameters (e.g. Range) and these added parameters won’t be signed. You must use <strong>signatureVersion v4</strong> to to include these parameters in the signed portion of the URL and enforce exact matching between headers and signed params in the URL.</p>\n</blockquote>\n<h3 id=\"2-url-생성하기\" style=\"position:relative;\"><a href=\"#2-url-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0\" aria-label=\"2 url 생성하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. URL 생성하기</h3>\n<p>기본적인 <strong>S3접근</strong> 세팅이 완료되면 간단한 코드로 <code class=\"language-text\">presigned-URL</code>을 생성할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> myBucket <span class=\"token operator\">=</span> <span class=\"token string\">'BucketName'</span>\n<span class=\"token keyword\">const</span> fileName <span class=\"token operator\">=</span> <span class=\"token string\">'FileName'</span>\n\n<span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> s3<span class=\"token punctuation\">.</span><span class=\"token function\">getSignedUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getObject'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    Bucket<span class=\"token operator\">:</span> myBucket<span class=\"token punctuation\">,</span>\n    Key<span class=\"token operator\">:</span> fileName<span class=\"token punctuation\">,</span>\n    Expires<span class=\"token operator\">:</span> <span class=\"token number\">30</span> <span class=\"token comment\">// 이 옵션에 따라서 URL, Presigned-URL로 구분된다.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">Expires</code> (default: 900s): 이 옵션을 추가해 주어야 <code class=\"language-text\">presigned-URL</code>이 생성된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># v4\nhttps://{Bucket}.s3.{region}.amazonaws.com/{FileName}?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential={KEY}%2F{region}%2Fs3%2Faws4_request&amp;X-Amz-Date=20190718T234545Z&amp;X-Amz-Expires=30&amp;X-Amz-Signature=d7f47df5514f17f725e2e5213ff58487dbc61122e9851feea43898587a38c5d1&amp;X-Amz-SignedHeaders=host\n\n# v2\nhttps://{Bucket}.s3.{region}.amazonaws.com/{FileName}?AWSAccessKeyId={KEY}&amp;Expires=1563493619&amp;Signature=OVRmBgNvivu8YNOUXNn9x6Wf%2BKE%3D</code></pre></div>\n<p>위와 같은 URL이 생성되면 앞서 설정한 Expire시간 동안 <strong>Access Permission</strong>이 부여된다.</p>\n<p>만약 해당 허용시간이 초과된다면 아래와 같은 화면이 출력되며 이는 <strong>Cloudfront</strong>에서 변경가능하다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAt0lEQVQY05WQYWvCMBCG+///nOBwfkhTN4lNe2nqktG1seojBhTZ2GR3PBy8HMf7XhFcwBtP3/d474n7yBAHpmnKpJR+8JdepM9Eu7SUC8XrcsVmXbFZVbS6IZrAMR35TxVj+MKtBacFrTS60qhSsS23OCXEXSANifO1z88pDuOB95c3dpXBNhZrLXVdI1ZojEVaya9wzuUpInRdd2ee5+zseiw7nMJIMB+c5tOvMW7LNxeP2vfIF9/lggB9Vl4yAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"presigned url\"\n        title=\"presigned url\"\n        src=\"/static/47e4a56a59d847e22fe7044f0f9c3020/c1b63/presigned-url.png\"\n        srcset=\"/static/47e4a56a59d847e22fe7044f0f9c3020/5a46d/presigned-url.png 300w,\n/static/47e4a56a59d847e22fe7044f0f9c3020/0a47e/presigned-url.png 600w,\n/static/47e4a56a59d847e22fe7044f0f9c3020/c1b63/presigned-url.png 1200w,\n/static/47e4a56a59d847e22fe7044f0f9c3020/9f9a4/presigned-url.png 1560w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>S3에 저장된 파일에 접근권한이 무엇이든 (Public, Private) 상관없지만, 사용의도에 맞게 <strong>Private</strong>으로 변경하는 것이 좋다.</p>\n<hr>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<ul>\n<li>\n<p><a href=\"https://aws.amazon.com/ko/blogs/korea/aws-api-call-2-s3-pre-signed-url/\">AWS API 호출하기 (2) - Amazon S3 객체에 대한 미리 선언된(pre-signed) URL 생성하기</a></p>\n</li>\n<li>\n<p><a href=\"https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html\">Class: AWS.S3 - AWS SDK for JavaScript</a></p>\n</li>\n<li>\n<p><a href=\"https://stackoverflow.com/questions/38831829/nodejs-aws-sdk-s3-generate-presigned-url\">Nodejs AWS SDK S3 Generate Presigned URL</a></p>\n</li>\n<li>\n<p><a href=\"https://medium.com/@labcloud/s3-pre-signed-url-%EB%AF%B8%EB%A6%AC-%EC%84%9C%EB%AA%85%EB%90%9C-url-%EB%A7%8C%EB%93%A4%EA%B8%B0-596aff8bdc45\">S3 pre-signed url (미리 서명된 url) 만들기 - Medium</a></p>\n</li>\n</ul>","fields":{"slug":"/aws/about_presigned_url/"},"frontmatter":{"title":"파일에 접근제한 부여하기 - Presigned URL","series_num":0,"date":"Sep 16. 2020","tags":["AWS","S3","CDN"]},"headings":[{"value":"Presigned-URL","depth":2,"id":"presigned-url"},{"value":"1. AWS-SDK 세팅하기","depth":3,"id":"1-aws-sdk-세팅하기"},{"value":"2. URL 생성하기","depth":3,"id":"2-url-생성하기"},{"value":"Reference","depth":2,"id":"reference"}]},"related":{"nodes":[{"fields":{"slug":"/aws/about_vpc/"},"frontmatter":{"title":"VPC란?","date":"Apr 11. 2021"}}]}},"pageContext":{"id":"1e55851e-1a3f-588c-b0da-091d9059fd95","slug":"/aws/about_presigned_url/","series_name":"","category":"AWS","previous":{"fields":{"slug":"/git/how_to_add_remote/"},"frontmatter":{"title":"Local 저장소와 Github 연결하기"}},"next":{"fields":{"slug":"/typescript/typescript_solid_1/"},"frontmatter":{"title":"solid하게 SOLID (1)"}}}},"staticQueryHashes":["1069093791","1381152472","1821008744","278901532","3528274121"]}