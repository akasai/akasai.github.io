{"componentChunkName":"component---src-template-post-tsx","path":"/node-js/about_node_js_1/","result":{"data":{"site":{"siteMetadata":{"comment":{"utterances":"akasai/akasai.github.io"}}},"post":{"id":"fa6af218-a2e2-5e17-a4fb-84af5b8ff92c","excerpt":"Node.js를 이용하고 개발을 하면서 너무나 자연스럽게 callback 을 다루면서 callback헬 을 겪었다. 본격적으로 Promise를 이용한 비동기 처리를 배우고 async/await…","timeToRead":3,"html":"<p>Node.js를 이용하고 개발을 하면서 너무나 자연스럽게 <strong>callback</strong> 을 다루면서 <strong>callback헬</strong> 을 겪었다.</p>\n<p>본격적으로 <strong>Promise</strong>를 이용한 비동기 처리를 배우고 <strong>async/await</strong> 를 사용하여 편리하게 비동기 처리를 하고 있지만,</p>\n<p>정작 내부적으로 어떤 방식으로 동작하는지 정확히 알지 못하고 사용했다.</p>\n<hr>\n<h2 id=\"javascript-엔진-구조\" style=\"position:relative;\"><a href=\"#javascript-%EC%97%94%EC%A7%84-%EA%B5%AC%EC%A1%B0\" aria-label=\"javascript 엔진 구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Javascript 엔진 구조</h2>\n<blockquote>\n<p>비동기 이벤트 주도 Javascript 런타임으로써 Node.js는 확장성있는 네트워크 애플리케이션을 만들 수 있도록 설계되었습니다.</p>\n</blockquote>\n<p>Node.js는 이벤트 기반 자바스크립트 런타임으로 구글에서 개발한 <code class=\"language-text\">V8 엔진</code> 의 특징을 동일하게 갖는다.</p>\n<p><strong>이벤트 루프</strong>를 기반의 비동기 방식으로 <code class=\"language-text\">Non-Blocking IO</code>를 통해 싱글 스레드로 동작하지만 동시성을 지원한다.</p>\n<p>Javascript 엔진은 크게 두 가지 영역으로 나뉜다.</p>\n<h3 id=\"call-stack\" style=\"position:relative;\"><a href=\"#call-stack\" aria-label=\"call stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Call Stack</h3>\n<p>코드의 실행에 따라 호출 스택이 쌓여 처리되는 곳이다.</p>\n<p><strong>단 한개의</strong> 콜 스택을 가지고 있으며 이것은 <span class=\"em red\">동시에 단 하나의 작업만을 할 수 있다는 의미이다.</span></p>\n<p>함수가 실행되면 콜스택에 순차적으로 Push되고 함수가 종료되면 Pop되는 **FILO(First In Last Out)**형태로 동작한다.</p>\n<p>이런 특징을 지닌 Javascript엔진은 <code class=\"language-text\">Event Loop</code>와 <code class=\"language-text\">Queue</code>를 이용하여 비동기처리가 가능하게 된다.</p>\n<h3 id=\"heap\" style=\"position:relative;\"><a href=\"#heap\" aria-label=\"heap permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Heap</h3>\n<p>대부분 구조화되지 않는 <code class=\"language-text\">더미(dummy)</code>같은 메모리 영역을 **힙(heap)**이라고 한다.</p>\n<p>동적으로 생성된 변수, 객체(인스턴스)는 **힙(heap)**에 할당된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABg0lEQVQoz5WSa0/CMBSG+U18N/5K/AXqBz8RsyiXYeQyAjKmiHGMS9eyi2xsILuh27pZR0KMYUPfNE3PaZ9z3rTNxemKkpGhXAoVh58K3naijw729X3yD3CEyRS8X7Gl03rxJLBK++QROIoijAOysBcX54X85VneM6mEDY/AUaKdw8B99LTCVi/47uuPzSirs+t6lmU7rmM73i7j+/5qtVqv12EYZnUOQ9xuM3TlpnHXKJfKtr2xrU21WqEoqlgsNptNUugAvPOjKHK91eXl+M1TmX4LiQgAIAjC7gzHcfP5fH/4N6wq8gM3MK24ZdAUd63JOkSQ5/kgCDDGBFYUJRWWJWkwGsWaGrP9CUJQFEmrXq+n6/pyuWQYRlXVdFiWnwaD7xiHwngMISQwy7KGYZimSeCsznNJFkbPt/exZsYITkQIEULD4dBxHM/ziIUseLFY0HR1+DKbTECtRouJbXLP3URkoWnaAXhfgjgHYArAjIg8DLkqkATT6VSSpCOf5F/6Apf1T6KyiLCdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"js1\"\n        title=\"js1\"\n        src=\"/static/44b6caf27337a5f2d63eee2a214696c3/2bef9/js1.png\"\n        srcset=\"/static/44b6caf27337a5f2d63eee2a214696c3/5a46d/js1.png 300w,\n/static/44b6caf27337a5f2d63eee2a214696c3/0a47e/js1.png 600w,\n/static/44b6caf27337a5f2d63eee2a214696c3/2bef9/js1.png 1024w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<hr>\n<h2 id=\"런타임\" style=\"position:relative;\"><a href=\"#%EB%9F%B0%ED%83%80%EC%9E%84\" aria-label=\"런타임 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>런타임</h2>\n<p><code class=\"language-text\">V8 엔진</code>과 같은 자바스크립트 엔진에는 한 개의 콜 스택을 이용하여 순차적으로 처리할 뿐, 흔히 알고 있는 <strong>이벤트 루프, 큐</strong> 가 없다.</p>\n<p>뿐만 아니라 주로 사용되는 <strong>DOM, Ajax, setTimeout</strong> 등과 같은 내장 API들 역시 자바스크립트 엔진에서 제공하지는 않는다.</p>\n<p>이 것들은 자바스크립트 엔진을 구동하는 **런타임 환경(브라우저나 Node.js)**이 제공해준다.</p>\n<blockquote>\n<p><strong>런타임</strong><br>\n프로그램이 실행되고 있는 때 존재하는 곳을 의미한다. 프로그래밍 언어가 구동되는 환경을 말하며,<br>\nJavascript는 브라우저, Node.js환경이 런타임이 될 수 있다.</p>\n</blockquote>\n<p>런타임 환경에서는 크게 세가지를 제공한다.</p>\n<h3 id=\"web-api\" style=\"position:relative;\"><a href=\"#web-api\" aria-label=\"web api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web API</h3>\n<p>런타임 환경에서 제공하는 API들이다.</p>\n<p>Javascript코드를 사용하여 접근할 수 있으며 window나 element에 대한 간단한 작업에서부터 WebGL이나 Web Audio와 같은 API를 사용해 복잡한 그래픽 및 오디오 효과를 만들어내는 것까지 가능하다.</p>\n<ol>\n<li>\n<p>DOM (document)</p>\n</li>\n<li>\n<p>Ajax (XMLHttpRequest)</p>\n</li>\n<li>\n<p>Timeout (setTimeout)</p>\n</li>\n</ol>\n<h3 id=\"event-loop\" style=\"position:relative;\"><a href=\"#event-loop\" aria-label=\"event loop permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Event Loop</h3>\n<p>반복하여 <strong>콜 스택</strong> 과 <strong>큐(Queue)</strong> 사이의 작업들을 확인하며, 콕 스택이 빈 상태가 되면 큐의 작업을 콜 스택에 넣는다.</p>\n<p>위와 같은 반족적인 작업을 <code class=\"language-text\">Tick</code>이라고 한다.</p>\n<p>일련의 작업들은 <strong>Event loop</strong>를 통해 <strong>콜 스택</strong>에서 처리된다.</p>\n<p>Node.js에서는 이벤트 루프를 이용하여 동시성을 지원한다.</p>\n<h3 id=\"queue\" style=\"position:relative;\"><a href=\"#queue\" aria-label=\"queue permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Queue</h3>\n<p>Task들이 임시로 저장되어 실행을 대기하는 **큐(Queue)**이다.</p>\n<p>콜스택이 빈 상태가 되면 **FIFO(First In First Out)**형태로 큐에서 스택으로 이동하고 작업이 수행된다.</p>\n<p>ES6 도입 이후로 <code class=\"language-text\">Microtask Queue</code>가 도입되어 대표적으로 3가지 종류의 큐가 존재한다.</p>\n<ol>\n<li>\n<p>Task Queue (Callback Queue)</p>\n<p><code class=\"language-text\">Promise</code>가 공개되기 이전 비동기로 호출되는 대부분의 작업들을 임시 저장하는 큐</p>\n</li>\n<li>\n<p>Microtask Queue</p>\n<p>Task Queue와 동일한 계층에 존재하며, <code class=\"language-text\">Promise</code> 비동기 호출작업들이 임시저장되는 큐</p>\n</li>\n<li>\n<p>Animation Frames</p>\n</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACUUlEQVQoz12T6U7bQBSF8/4vgFqppVLpD5CQipCKqNRSIBGhSYvwmniJ1xnHa+yEOAnBOb02SwpXOhrP4m/OvTPT2myAcrGE6/nwGMf9+gGbepCibp+/q6bdYHW/gu97iJOY5ioar16tb/lxAU7SnQCGOwZPpmCkt0CDZRDNFIIWofPXxLXgQKJ+rSCdbYFxPsfbqKHPoOeQRjEOf1g4ONXx+egGX44F7J8aOOl4cMJ8CwySAmtKo1wssKDUl8sl/CjHal01uluuMVsAA2bjoPcRe5fvsN/90GivvYMT6RBenG2BimFDVWTIsgJFUSBJEjSbo1hUSGb3GOdL8GkFZluYnn1C/nMXzvEO+Ml73J3torg6BA/T/4C6DUWWCCg3kiQRQwK+jZHDYPTaMPsdDK8vMOheNH3rtg8/nLwGygSpndUSBYGADHUFH6rtCVrBBAMnhGKP0dcYhnSIA5LqjF8fiqxbDVAUSQQUaqDFXpxVxJuvKgRJhoiuytAL8cdMkBQlsmmJeUm1p7pXT5u/pCw9pSyKAgxvjDCKoQ0H9OMd3ElF8x34gyPY6jc4zIcZ5NDIYRTSVePBSyYtWbMgiU8OxUeHqunBMMxmI23kICk3+N538fV8RNcnxIin0P20AXKCc87BGENZlmip5FCVxSbtppbiLaXskyMFuq7BDyJE8w3afQ3nPQuqm8IkoEZA04+RpQmyLEOapo/AnmTi8vctLnsC2qRf3Rt6EaxZYFsjTOf0LPMKQvcKrqHDjmeweEYuJ9DdEEHAEUURtQGKosA/O9dygWoIrVgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"js2\"\n        title=\"js2\"\n        src=\"/static/1d6eceee4c0f69326e44abe816bb9806/c1b63/js2.png\"\n        srcset=\"/static/1d6eceee4c0f69326e44abe816bb9806/5a46d/js2.png 300w,\n/static/1d6eceee4c0f69326e44abe816bb9806/0a47e/js2.png 600w,\n/static/1d6eceee4c0f69326e44abe816bb9806/c1b63/js2.png 1200w,\n/static/1d6eceee4c0f69326e44abe816bb9806/62da8/js2.png 1262w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<hr>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<ul>\n<li>\n<p><a href=\"https://asfirstalways.tistory.com/362\">[JS] Javascript의 Event Loop</a></p>\n</li>\n<li>\n<p><a href=\"https://iamsjy17.github.io/javascript/2019/07/20/how-to-works-js.html\">[Javascript] 자바스크립트의 호출 스택과 이벤트 루프</a></p>\n</li>\n<li>\n<p><a href=\"https://velog.io/@namezin/javascript-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC\">javascript 동작 원리</a></p>\n</li>\n</ul>","fields":{"slug":"/node-js/about_node_js_1/"},"frontmatter":{"title":"Node.js의 구조","series_num":1,"date":"Oct 06. 2020","tags":["Node.js","Javascript","V8","EventLoop"]},"headings":[{"value":"Javascript 엔진 구조","depth":2,"id":"javascript-엔진-구조"},{"value":"Call Stack","depth":3,"id":"call-stack"},{"value":"Heap","depth":3,"id":"heap"},{"value":"런타임","depth":2,"id":"런타임"},{"value":"Web API","depth":3,"id":"web-api"},{"value":"Event Loop","depth":3,"id":"event-loop"},{"value":"Queue","depth":3,"id":"queue"},{"value":"Reference","depth":2,"id":"reference"}]},"related":{"nodes":[{"fields":{"slug":"/node-js/about_node_js_2/"},"frontmatter":{"title":"Node.js의 이벤트 루프와 비동기","date":"Oct 08. 2020"}},{"fields":{"slug":"/node-js/about_node_js_5/"},"frontmatter":{"title":"Node.js의 I/O 동작","date":"Oct 21. 2020"}},{"fields":{"slug":"/node-js/about_node_js_3/"},"frontmatter":{"title":"비동기와 논블로킹","date":"Oct 12. 2020"}},{"fields":{"slug":"/node-js/about_node_js_package_top10/"},"frontmatter":{"title":"2020 TOP 10 Node.js Package & Framework","date":"Oct 12. 2020"}},{"fields":{"slug":"/node-js/solving_promise_bottleneck/"},"frontmatter":{"title":"async/await 병목현상 줄여보기","date":"Sep 21. 2020"}},{"fields":{"slug":"/node-js/about_node_js_4/"},"frontmatter":{"title":"Node.js의 스레드","date":"Oct 13. 2020"}}]}},"pageContext":{"id":"fa6af218-a2e2-5e17-a4fb-84af5b8ff92c","slug":"/node-js/about_node_js_1/","series_name":"Node.js 파헤치기","category":"Node.js","previous":{"fields":{"slug":"/db/about_lock/"},"frontmatter":{"title":"DB의 Lock/DeadLock"}},"next":{"fields":{"slug":"/node-js/about_node_js_2/"},"frontmatter":{"title":"Node.js의 이벤트 루프와 비동기"}}}},"staticQueryHashes":["1069093791","1381152472","1821008744","278901532","3528274121"]}